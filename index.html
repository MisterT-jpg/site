<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Cooldown Trainer - LoL</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    h1, h2, h3 { margin: 10px 0; text-align: center; }
    #modeSelector { margin-bottom: 20px; }
    select, input[type="text"] {
      padding: 10px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      margin: 10px;
    }
    button {
      background: #ffd700;
      border: none;
      color: #222;
      font-weight: 700;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.15s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }
    button:hover { background: #ffea3c; transform: scale(1.05); }
    button:active { transform: scale(0.95); }
    #resultat, #score, #timerDisplay {
      font-size: 1.2rem;
      font-weight: 600;
      min-height: 2em;
      text-align: center;
    }
    #historique {
      margin-top: 30px;
      max-width: 600px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .essai {
      background: rgba(255, 255, 255, 0.1);
      border-left: 5px solid;
      padding: 10px;
      border-radius: 6px;
      animation: fadeIn 0.3s ease;
    }
    .correct { border-color: #4CAF50; }
    .incorrect { border-color: #F44336; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <h1>Cooldown Trainer - LoL</h1>

  <div id="modeSelector">
    <label for="mode">Choisissez un mode :</label>
    <select id="mode">
      <option value="normal">Normal</option>
      <option value="chrono">Chrono (60s)</option>
      <option value="hardcore">Hardcore</option>
    </select>
    <button onclick="demarrerSession()">Démarrer</button>
  </div>

  <h2 id="sort">Prêt ?</h2>
  <input type="text" id="cdInput" placeholder="Entrer le CD" disabled />
  <div>
    <button id="verifierBtn" onclick="verifier()" disabled>Vérifier</button>
    <button onclick="cdSuivant()" disabled id="nextBtn">CD suivant</button>
    <button onclick="finSession()" disabled id="finBtn">Fin de session</button>
    <button onclick="nouvelleSession()" style="display:none" id="resetBtn">Nouvelle session</button>
  </div>

  <div id="timerDisplay"></div>
  <p id="resultat"></p>
  <h3 id="score"></h3>

  <div id="historique"></div>

  <script>
    let allSpells = {}, currentSpell = {}, modeJeu = 'normal';
    let dejaVerifie = false, score = 0, total = 0;
    let historique = [], sessionActive = false, timer = null, timeLeft = 60;

    async function chargerSort() {
      if (!sessionActive) return;
      if (Object.keys(allSpells).length === 0) {
        const res = await fetch("data/championFull.json");
        const json = await res.json();
        const champions = json.data;
        for (const champKey in champions) {
          const champ = champions[champKey];
          const spells = champ.spells;
          if (spells.length === 4) {
            allSpells[champ.name + " Q"] = spells[0].cooldown[0];
            allSpells[champ.name + " W"] = spells[1].cooldown[0];
            allSpells[champ.name + " E"] = spells[2].cooldown[0];
            allSpells[champ.name + " R"] = spells[3].cooldown[0];
          }
        }
      }
      const keys = Object.keys(allSpells);
      const randomKey = keys[Math.floor(Math.random() * keys.length)];
      currentSpell = { name: randomKey, cd: allSpells[randomKey].toString() };
      dejaVerifie = false;
      document.getElementById("verifierBtn").disabled = false;
      document.getElementById("sort").innerText = currentSpell.name;
      document.getElementById("resultat").innerText = "";
      document.getElementById("cdInput").value = "";
      document.getElementById("cdInput").focus();
    }

    function verifier() {
      if (!sessionActive || dejaVerifie) return;
      const input = document.getElementById("cdInput").value.trim();
      const res = document.getElementById("resultat");
      if (!/^\d+$/.test(input)) {
        res.innerText = "⚠️ Entrez un nombre valide";
        res.style.color = "#FFA500";
        return;
      }
      dejaVerifie = true;
      document.getElementById("verifierBtn").disabled = true;
      const correct = input === currentSpell.cd;
      if (correct) score++; else if (modeJeu === 'hardcore') return finSession();
      total++;
      res.innerText = correct ? "✅ Correct !" : `❌ Faux. CD : ${currentSpell.cd}`;
      res.style.color = correct ? "#4CAF50" : "#F44336";
      historique.push({ sort: currentSpell.name, reponse: input, correct: currentSpell.cd, status: correct });
      majScore(); ajouterCarteHistorique(historique[historique.length - 1]);
    }

    function ajouterCarteHistorique(e) {
      const c = document.createElement("div");
      c.className = "essai " + (e.status ? "correct" : "incorrect");
      c.innerHTML = `<strong>${e.sort}</strong><div>Votre réponse : ${e.reponse}</div><div>CD : ${e.correct}</div>`;
      document.getElementById("historique").prepend(c);
    }

    function majScore() {
      document.getElementById("score").innerText = `Score : ${score} / ${total}`;
    }

    function cdSuivant() {
      chargerSort();
    }

    function demarrerSession() {
      modeJeu = document.getElementById("mode").value;
      sessionActive = true; score = 0; total = 0; historique = [];
      document.getElementById("historique").innerHTML = "";
      document.getElementById("cdInput").disabled = false;
      document.getElementById("resetBtn").style.display = "none";
      document.getElementById("nextBtn").disabled = false;
      document.getElementById("finBtn").disabled = false;
      majScore();
      chargerSort();
      if (modeJeu === 'chrono') lancerChrono();
    }

    function finSession() {
      sessionActive = false;
      document.getElementById("sort").innerText = "Session terminée.";
      document.getElementById("cdInput").disabled = true;
      document.getElementById("verifierBtn").disabled = true;
      document.getElementById("nextBtn").disabled = true;
      document.getElementById("finBtn").disabled = true;
      document.getElementById("resetBtn").style.display = "inline-block";
      if (timer) clearInterval(timer);
      document.getElementById("timerDisplay").innerText = '';
    }

    function nouvelleSession() {
      document.getElementById("cdInput").value = "";
      document.getElementById("resultat").innerText = "";
      demarrerSession();
    }

    function lancerChrono() {
      timeLeft = 60;
      const tDisplay = document.getElementById("timerDisplay");
      tDisplay.innerText = `⏱️ Temps restant : ${timeLeft}s`;
      timer = setInterval(() => {
        timeLeft--;
        tDisplay.innerText = `⏱️ Temps restant : ${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timer);
          finSession();
        }
      }, 1000);
    }

    window.onload = () => {
      document.getElementById("cdInput").addEventListener("keydown", (e) => {
        if (e.key === "Enter") verifier();
      });
      document.getElementById("cdInput").addEventListener("input", () => {
        document.getElementById("resultat").innerText = "";
      });
    };
  </script>
</body>
</html>